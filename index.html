<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (made by Rogov)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            margin: 0;
            padding: 0;
        }

        body {
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        body.dark-mode {
            background-color: #202020;
            color: #f0f0f0;
        }

        .container.dark-mode {
            background-color: #181818;
        }

        .dark-mode h1,
        .dark-mode #result-container h2 {
            color: #f0f0f0;
        }

        .theme-toggle {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: #6b6b6b;
            color: white;
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .container {
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 10px;
            background-color: #fff;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            color: #333;
        }

        .custom-file-input {
            display: none;
        }

        .custom-file-label {
            background-color: #6b6b6b;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            display: inline-block;
        }

        .custom-file-label:hover {
            background-color: #000;
        }

        .file-info {
            margin-top: 10px;
            font-size: 16px;
            color: #333;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .file-info.show {
            opacity: 1;
        }

        .btn {
            margin: 1rem 0;
            display: flex;
            justify-content: flex-start;
        }

        .btn button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .btn button.active {
            background-color: #000;
            color: white;
        }

        .btn button:not(.active) {
            background-color: #6b6b6b;
            color: white;
        }

        .btn button:hover:not(.active) {
            background-color: #000;
        }

        #nextBtn {
            background-color: green;
            color: white;
        }

        #nextBtn:hover {
            background-color: rgb(0, 90, 0);
        }

        #nextBtn:active {
            background-color: black;
        }

        #restartBtn {
            border: none;
            color: #fff;
            background-color: #333;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        #restartBtn:hover {
            background-color: #000;
        }

        #restartBtn:active {
            color: white;
            background-color: #000;
        }

        input[type="radio"] {
            margin-right: 10px;
        }

        #result-container {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #f0f0f0;
        }

        #result-container h2 {
            margin-bottom: 10px;
            color: #333;
        }

        .dropdown {
            position: relative;
            display: inline-block;
            margin-right: 10px;
        }

        .dropbtn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            background-color: #6b6b6b;
            color: white;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            background-color: #f9f9f9;
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
            z-index: 1;
        }

        .dropdown-content a {
            color: black;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
        }

        .dropdown-content a:hover {
            background-color: #f1f1f1;
        }

        .dropdown:hover .dropdown-content {
            display: block;
        }

        .dropdown:hover .dropbtn {
            background-color: #000;
        }

        .incorrect-answer {
            background-color: #e14c4c;
            border-radius: 6px;
            padding: 1px;
        }

        .correct-answer {
            background-color: #81C784;
            border-radius: 6px;
            padding: 1px;
        }

        .partially-correct-answer {
            background-color: #64B5F6;
            border-radius: 6px;
            padding: 1px;
        }

        input[type="radio"]:checked+label,
        input[type="checkbox"]:checked+label {
            background-color: #4CAF50;
        }

        #searchInput {
            width: 100%;
            padding: 10px;
            margin-top: 30px;
            margin-bottom: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
        }

        .hidden {
            display: none;
        }

        #searchInput {
            display: none;
        }

        .dark-mode-result {
            background-color: #444;
            /* –±–æ–ª–µ–µ —Å–≤–µ—Ç–ª—ã–π —Ñ–æ–Ω */
            color: #fff;
            border: 1px solid #888;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
        }

        .highlight {
            background-color: yellow;
            /* –¶–≤–µ—Ç –ø–æ–¥—Å–≤–µ—Ç–∫–∏ */
        }


        #streakCounter {
            position: absolute;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #ffcc70, #ff9a76);
            padding: 8px 14px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            color: #000;
            box-shadow: 0 0 8px rgba(255, 150, 0, 0.5);
            display: none;
            z-index: 10;
            animation: pulseBadge 1s ease infinite alternate;
        }

        @keyframes pulseBadge {
            from {
                transform: scale(1);
                box-shadow: 0 0 5px rgba(255, 170, 0, 0.4);
            }

            to {
                transform: scale(1.05);
                box-shadow: 0 0 12px rgba(255, 100, 0, 0.8);
            }
        }




        @media (max-width: 768px) {
            .btn {
                justify-content: flex-end;
            }

            .dropbtn,
            .btn button {
                padding: 8px 15px;
                font-size: 14px;
            }

            #nextBtn {
                width: 50%;
                padding: 15px 15px;
            }

            .dropdown-content a {
                font-size: 14px;
                padding: 10px 12px;
            }
        }
    </style>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>

<body>
    <div class="container">
        <button class="theme-toggle">–¢–µ–º–Ω–∞—è/–°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞</button>

        <!-- Dropdown –¥–ª—è –≤—ã–±–æ—Ä–∞ –≥—Ä—É–ø–ø—ã (–≤–µ—Ç–∫–∏ GitHub) -->
        <div class="dropdown">
            <button class="dropbtn" id="branchDropbtn">–ó–∞–≥—Ä—É–∑–∫–∞ –≥—Ä—É–ø–ø...</button>
            <div class="dropdown-content" id="branchDropdownContent"></div>
        </div>

        <!-- Dropdown –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞ (–ª–æ–∫–∞–ª—å–Ω—ã–π –∏–ª–∏ —Å GitHub) -->
        <div class="dropdown">
            <button class="dropbtn" id="fileDropbtn">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª &#9660;</button>
            <div class="dropdown-content" id="fileDropdownContent">
                <!-- –ü–µ—Ä–≤—ã–π –ø—É–Ω–∫—Ç ‚Äì –ª–æ–∫–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ -->
                <a href="#" id="localUploadLink">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</a>
            </div>
        </div>

        <!-- Dropdown –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ä–µ–∂–∏–º–∞ -->
        <div class="dropdown">
            <button class="dropbtn" id="modeDropbtn">–†–µ–∂–∏–º &#9660;</button>
            <div class="dropdown-content">
                <a id="normalModeBtn" class="active">–û–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º</a>
                <a id="testModeBtn">–¢–µ—Å—Ç-–∫–∞–±–∏–Ω–µ—Ç</a>
                <a id="quickReviewModeBtn">–†–µ–∂–∏–º –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è</a>
                <a id="rangeModeBtn">–†–µ–∂–∏–º –≤—ã–±–æ—Ä–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–∞</a>
            </div>
        </div>
        <!-- HTML: –ë–ª–æ–∫ –≤—ã–±–æ—Ä–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ —Å –¥–æ—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–º–∏ –∫–Ω–æ–ø–∫–∞–º–∏ -->
        <div id="range-selection" style="display:none; margin: 10px 0;">
            <input type="number" id="range-start" placeholder="–û—Ç –≤–æ–ø—Ä–æ—Å–∞" min="1" style="width: 100px;">
            <input type="number" id="range-end" placeholder="–î–æ –≤–æ–ø—Ä–æ—Å–∞" min="1"
                style="width: 100px; margin-left: 10px;">
            <button id="apply-range-btn" class="dropbtn" style="margin-left: 10px;">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
            <button id="randomize-range-btn" class="dropbtn"
                style="margin-left: 10px; display:none;">–†–∞–Ω–¥–æ–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å</button>
            <div id="range-preview" style="margin-top: 10px; font-size: 14px; color: #333;"></div>
        </div>


        <div>
            <input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫ –≤–æ–ø—Ä–æ—Å–æ–≤..." oninput="searchQuestions()">
        </div>
        <hr>
        <div class="file-info" id="fileInfo"></div>
        <div id="question-container"></div>
        <!-- <div id="streakCounter">
            üî• <span id="streakText">–°–µ—Ä–∏—è: </span><span id="streakValue">0</span>
        </div> -->



        <div class="btn">
            <button id="nextBtn">–î–∞–ª–µ–µ</button>
            <button id="skipBtn" style="display: none;">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å</button>
        </div>
        <div id="result-container" style="display: none;"></div>

        <!-- –°–∫—Ä—ã—Ç—ã–π input –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞ -->
        <input type="file" id="fileInput" class="custom-file-input" style="display: none;">
    </div>

    <script>
        /********************** –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–π **********************/
        const STATE_VERSION = 1;
        const SAVE_EXPIRY = 48 * 60 * 60 * 1000; // 48 —á–∞—Å–æ–≤
        const RESULTS_STORAGE_KEY = "monthlyTestResults";

        /********************** –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ **********************/
        let questions = [];
        let originalQuestions = [];
        let currentQuestionIndex = 0;
        let startTime = null;
        let answered = false;
        let incorrectQuestions = [];
        let incorrectAnswerCount = 0;
        let isReviewMode = false;
        let totalQuestionsCount = 0;
        let endTime = null;
        let testFinished = false;
        let lastTimeTaken = 0, lastIncorrectCount = 0;
        let currentPoints = 0;
        const quickReviewChunkSize = 20;
        let currentStreak = 0;



        /********************** –≠–ª–µ–º–µ–Ω—Ç—ã DOM **********************/
        const fileInput = document.getElementById('fileInput');
        const fileDropdownContent = document.getElementById('fileDropdownContent');
        const fileDropbtn = document.getElementById('fileDropbtn');
        const localUploadLink = document.getElementById('localUploadLink');
        const questionContainer = document.getElementById('question-container');
        const nextBtn = document.getElementById('nextBtn');
        const skipBtn = document.getElementById('skipBtn');
        const resultContainer = document.getElementById('result-container');
        const normalModeBtn = document.getElementById('normalModeBtn');
        const testModeBtn = document.getElementById('testModeBtn');
        const quickReviewModeBtn = document.getElementById('quickReviewModeBtn');
        const rangeModeBtn = document.getElementById('rangeModeBtn');
        const searchInput = document.getElementById('searchInput');
        const modeDropbtn = document.getElementById('modeDropbtn');
        const rangeSelectionDiv = document.getElementById('range-selection');
        const applyRangeBtn = document.getElementById('apply-range-btn');
        const randomizeRangeBtn = document.getElementById('randomize-range-btn');
        const rangeStartInput = document.getElementById('range-start');
        const rangeEndInput = document.getElementById('range-end');
        rangeStartInput.addEventListener('input', updateRangePreview);
        rangeEndInput.addEventListener('input', updateRangePreview);
        const streakEl = document.getElementById('streakCounter');
        const streakValue = document.getElementById('streakValue');

        const rangePreviewDiv = document.getElementById('range-preview');

        function updateStreak(isCorrect) {
            if (!streakEl || !streakValue) return;

            if (isCorrect) {
                currentStreak++;
                streakEl.style.display = 'block';
                streakValue.textContent = currentStreak;

                // –ú–µ–Ω—è–µ–º —Ç–µ–∫—Å—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –¥–ª–∏–Ω—ã —Å–µ—Ä–∏–∏
                const text = currentStreak < 3 ? '–°–µ—Ä–∏—è: ' :
                    currentStreak < 5 ? '–†–∞–∑–≥–æ–Ω!' :
                        currentStreak < 8 ? '–í –ø–æ—Ç–æ–∫–µ!' :
                            'üî• –ù–µ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å!';
                document.getElementById('streakText').textContent = text + ' ';

                // –í–∏–∑—É–∞–ª—å–Ω—ã–π "–≤—Å–ø–ª–µ—Å–∫"
                streakEl.style.background = 'linear-gradient(135deg, #fff6b7, #fcd271)';
                setTimeout(() => {
                    streakEl.style.background = 'linear-gradient(135deg, #ffe29f, #ffa99f)';
                }, 300);

            } else {
                currentStreak = 0;
                streakEl.style.display = 'none';
            }
        }





        /********************** –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ—Å—Ç–æ–≤ —Å GitHub **********************/
        async function loadFilesFromGitHub() {
            const repoOwner = 'FORBIX7';
            const repoName = 'lab02-';
            const branch = currentBranch;

            const apiUrl = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/?ref=${branch}`;
            try {
                const response = await fetch(apiUrl);
                if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö —Å GitHub');
                const files = await response.json();
                displayGitHubFiles(files);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
            }
        }
        function displayGitHubFiles(files) {
            fileDropdownContent.innerHTML = '';
            const localUpload = document.createElement('a');
            localUpload.href = '#';
            localUpload.textContent = '–ó–∞–≥—Ä—É–∑–∏—Ç—å —Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞';
            localUpload.addEventListener('click', (e) => {
                e.preventDefault();
                fileInput.click();
                updateFileDropdownText('–ó–∞–≥—Ä—É–∑–∏—Ç—å —Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞');
            });
            fileDropdownContent.appendChild(localUpload);
            files.forEach(file => {
                if (file.type === 'file' && file.name.endsWith('.json')) {
                    const fileLink = document.createElement('a');
                    fileLink.href = '#';
                    fileLink.textContent = file.name;
                    fileLink.addEventListener('click', (e) => {
                        e.preventDefault();
                        loadQuestionsFromGitHub(file.download_url);
                        updateFileDropdownText(file.name);
                    });
                    fileDropdownContent.appendChild(fileLink);
                }
            });
        }
        async function loadQuestionsFromGitHub(fileUrl) {
            localStorage.removeItem('testAppState');
            try {
                const response = await fetch(fileUrl);
                if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–∞ —Å GitHub');
                const contents = await response.json();
                questions = contents;
                originalQuestions = [...contents];
                restartTest();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
            }
        }
        function updateFileDropdownText(text) {
            fileDropbtn.textContent = `${text} \u25BC`;
        }
        fileInput.addEventListener('change', (event) => {
            localStorage.removeItem('testAppState');
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    questions = JSON.parse(e.target.result);
                    originalQuestions = [...questions];
                    restartTest();
                    updateFileDropdownText(file.name);
                } catch (err) {
                    console.error('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON:', err);
                }
            };
            reader.readAsText(file);
        });

        /********************** –¢–µ–º–∞ (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Ç–µ–º—ã) **********************/
        function loadTheme() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
                document.querySelector('.container').classList.add('dark-mode');
            } else {
                document.body.classList.remove('dark-mode');
                document.querySelector('.container').classList.remove('dark-mode');
            }
        }
        document.querySelector('.theme-toggle').addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            document.querySelector('.container').classList.toggle('dark-mode');
            if (document.body.classList.contains('dark-mode')) {
                localStorage.setItem('theme', 'dark');
            } else {
                localStorage.setItem('theme', 'light');
            }
            if (resultContainer.style.display === 'block') {
                showResult(lastTimeTaken, lastIncorrectCount, currentPoints);
            }
        });

        /********************** Debounce –¥–ª—è –ø–æ–∏—Å–∫–∞ **********************/
        let searchTimeout;
        function debounceSearch(callback, delay = 300) {
            return function (...args) {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => callback.apply(this, args), delay);
            };
        }
        searchInput.addEventListener('input', debounceSearch(() => {
            searchQuestions();
        }, 300));
        function searchQuestions() {
            const searchValue = searchInput.value.toLowerCase().trim();

            if (searchValue.length === 0) {
                // üîÅ –í–µ—Ä–Ω—É—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ —Ä–µ–∂–∏–º –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è
                if (quickReviewModeBtn.classList.contains('active')) {
                    // !!! –í–û–¢ –ó–î–ï–°–¨ –ù–£–ñ–ù–´ –ò–ó–ú–ï–ù–ï–ù–ò–Ø !!!
                    quickReviewOffset = 0; // –°–±—Ä–æ—Å–∏—Ç—å —Å–º–µ—â–µ–Ω–∏–µ –Ω–∞ –Ω–∞—á–∞–ª–æ —Å–ø–∏—Å–∫–∞
                    questionContainer.innerHTML = ''; // –û–ß–ò–°–¢–ò–¢–¨ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –æ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞
                    showQuickReviewMode(); // –¢–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã —Å —Å–∞–º–æ–≥–æ –Ω–∞—á–∞–ª–∞
                } else {
                    // –≠—Ç–æ—Ç –±–ª–æ–∫ –º–µ–Ω–µ–µ –∫—Ä–∏—Ç–∏—á–µ–Ω, —Ç.–∫. –ø–æ–∏—Å–∫ –∞–∫—Ç–∏–≤–µ–Ω —Ç–æ–ª—å–∫–æ –≤ —Ä–µ–∂–∏–º–µ –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è
                    questionContainer.innerHTML = '<p>–í–≤–µ–¥–∏—Ç–µ —Ö–æ—Ç—è –±—ã 2 —Å–∏–º–≤–æ–ª–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞.</p>';
                }
                return;
            }

            if (searchValue.length < 2) {
                questionContainer.innerHTML = '<p>–í–≤–µ–¥–∏—Ç–µ —Ö–æ—Ç—è –±—ã 2 —Å–∏–º–≤–æ–ª–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞.</p>';
                return;
            }

            const filtered = originalQuestions.filter(q =>
                q.question.toLowerCase().includes(searchValue)
            );

            if (filtered.length === 0) {
                questionContainer.innerHTML = `<p>–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –ø–æ –∑–∞–ø—Ä–æ—Å—É "<strong>${searchValue}</strong>".</p>`;
                return;
            }

            // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞ (—ç—Ç–æ—Ç –±–ª–æ–∫ —É —Ç–µ–±—è —É–∂–µ –µ—Å—Ç—å –∏ –æ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω –¥–ª—è –ø–æ–∏—Å–∫–∞)
            questionContainer.innerHTML = filtered.map((q, index) => {
                const highlighted = q.question.replace(
                    new RegExp(searchValue, 'gi'),
                    match => `<span class="highlight">${match}</span>`
                );
                const choices = q.choices.map(choice => {
                    const isCorrect = q.correctAnswers.includes(choice);
                    return `<div class="${isCorrect ? 'correct-answer' : ''}">‚Äî ${choice}</div>`;
                }).join('');

                return `
            <hr>
            <div style="margin-bottom: 1em;">
                <strong>–í–æ–ø—Ä–æ—Å:</strong> ${highlighted}<br>
                ${choices}
                ${q.image ? `<img src="${q.image}" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ" style="max-width: 100%; height: auto;">` : ''}
            </div>
        `;
            }).join('');

            // –ù–µ –∑–∞–±—É–¥—å –ø—Ä–æ MathJax, –µ—Å–ª–∏ –æ–Ω –Ω—É–∂–µ–Ω –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞
            if (window.MathJax && MathJax.typesetPromise) {
                MathJax.typesetPromise();
            }
        }



        function displayQuestions(filteredQuestions, searchValue) {
            questionContainer.innerHTML = '';
            filteredQuestions.forEach((q, index) => {
                let choicesHTML = '';
                q.choices.forEach(choice => {
                    const answerClass = q.correctAnswers.includes(choice) ? 'correct-answer' : '';
                    choicesHTML += `<br>--<label class="${answerClass}">${choice}</label><br>`;
                });

                // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Å–æ–≤–ø–∞–≤—à–µ–≥–æ —Ç–µ–∫—Å—Ç–∞ –≤ –≤–æ–ø—Ä–æ—Å–µ
                const highlightedQuestion = q.question.replace(
                    new RegExp(searchValue, 'gi'),
                    match => `<span class="highlight">${match}</span>`
                );

                const questionHTML = `
            <hr>
            <h5>–í–æ–ø—Ä–æ—Å ${index + 1} / ${filteredQuestions.length}</h5>
            <h4>${highlightedQuestion}</h4>
            ${choicesHTML}
            ${q.image ? `<img src="${q.image}" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ" style="max-width: 100%; height: auto;">` : ''}
        `;
                questionContainer.innerHTML += questionHTML;
            });
        }


        /********************** –†–µ–∂–∏–º—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è **********************/
        function restartTest() {
            testFinished = false;
            questionContainer.style.display = 'block';
            nextBtn.style.display = 'block';
            resultContainer.style.display = 'none';
            currentQuestionIndex = 0;
            incorrectQuestions = [];
            startTime = null;
            answered = false;
            incorrectAnswerCount = 0;
            currentPoints = 0;
            isReviewMode = false;
            testFinished = false;

            // üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –µ—Å–ª–∏ "–ë—ã—Å—Ç—Ä—ã–π –ø–æ–≤—Ç–æ—Ä", –∑–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã –∏ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º offset
            if (quickReviewModeBtn.classList.contains('active')) {
                quickReviewOffset = 0;
                questions = [...originalQuestions];             // ‚Üê –í–ê–ñ–ù–û: –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±—Ä–µ–∑–∞–Ω–Ω—ã–π –º–∞—Å—Å–∏–≤
                questionContainer.innerHTML = '';               // ‚Üê –æ—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
                showQuickReviewMode();                          // ‚Üê –∑–∞–ø—É—Å–∫–∞–µ–º —Ä–µ–∂–∏–º
                return;                                          // ‚Üê –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –¥–≤–æ–π–Ω–æ–π –≤—ã–∑–æ–≤
            }

            // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω —Ä–µ–∂–∏–º –≤—ã–±–æ—Ä–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–∞, –Ω–µ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º –≤–æ–ø—Ä–æ—Å—ã
            if (!rangeModeBtn.classList.contains('active')) {
                if (testModeBtn.classList.contains('active')) {
                    questions = getRandomQuestions(50);
                } else {
                    questions = [...originalQuestions];
                }
            }

            totalQuestionsCount = questions.length;

            // –ï—Å–ª–∏ –∞–∫—Ç–∏–≤–µ–Ω —Ä–µ–∂–∏–º –¥–∏–∞–ø–∞–∑–æ–Ω–∞, –∫–Ω–æ–ø–∫–∞ —Ä–∞–Ω–¥–æ–º–∏–∑–∞—Ü–∏–∏ –≤–∏–¥–Ω–∞
            if (rangeModeBtn.classList.contains('active')) {
                randomizeRangeBtn.style.display = "inline-block";
            } else {
                randomizeRangeBtn.style.display = "none";
            }

            // –ó–∞–ø—É—Å–∫ –≤–æ–ø—Ä–æ—Å–æ–≤
            showQuestion();
        }

        function updateRangePreview() {
            const start = parseInt(rangeStartInput.value);
            const end = parseInt(rangeEndInput.value);

            if (isNaN(start) || isNaN(end) || start < 1 || end < start || end > originalQuestions.length) {
                rangePreviewDiv.innerHTML = '<p style="color: red;">–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω</p>';
                return;
            }

            const preview = originalQuestions.slice(start - 1, end)
                .map((q, idx) => `<li>–í–æ–ø—Ä–æ—Å ${start + idx}: ${q.question.substring(0, 80)}...</li>`)
                .join('');

            rangePreviewDiv.innerHTML = `
        <p><strong>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä (${end - start + 1} –≤–æ–ø—Ä–æ—Å–æ–≤):</strong></p>
        <ul style="padding-left: 20px;">${preview}</ul>
    `;
        }

        function getRandomQuestions(count) {
            const shuffled = [...originalQuestions].sort(() => Math.random() - 0.5);
            return shuffled.slice(0, count);
        }
        function arraysEqual(arr1, arr2) {
            if (arr1.length !== arr2.length) return false;
            const sorted1 = [...arr1].sort();
            const sorted2 = [...arr2].sort();
            return sorted1.every((value, index) => value === sorted2[index]);
        }
        function showQuestion() {
            if (questions.length === 0) {
                questionContainer.innerHTML = '<p>–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤.</p>';
                return;
            }
            const question = questions[currentQuestionIndex];
            let choicesHTML = '';
            if (question.correctAnswers.length > 1) {
                choicesHTML = question.choices.map(choice => {
                    return `<label style="display: block;">
                          <input type="checkbox" name="answer" value="${choice}"> ${choice}
                        </label><br>`;
                }).join('');
            } else {
                choicesHTML = question.choices.map(choice => {
                    return `<label style="display: block;">
                          <input type="radio" name="answer" value="${choice}"> ${choice}
                        </label><br>`;
                }).join('');
            }
            const questionHTML = `
                <p>${isReviewMode ? '–†–∞–±–æ—Ç–∞ –Ω–∞–¥ –æ—à–∏–±–∫–∞–º–∏' : `–í–æ–ø—Ä–æ—Å ${currentQuestionIndex + 1} / ${questions.length}`}</p>
                <h4>${question.question}</h4>
                ${choicesHTML}
            `;
            questionContainer.innerHTML = question.image
                ? questionHTML + `<img src="${question.image}" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ" style="max-width: 100%; height: auto;">`
                : questionHTML;
            if (window.MathJax && MathJax.typesetPromise) {
                MathJax.typesetPromise();
            }
            if (!startTime) startTime = new Date();
            skipBtn.style.display = isReviewMode ? 'block' : 'none';
        }

        nextBtn.addEventListener('click', () => {
            if (!answered) {
                const selectedAnswers = Array.from(document.querySelectorAll('input[name="answer"]:checked'))
                    .map(input => input.value);
                const correctAnswers = questions[currentQuestionIndex].correctAnswers;
                const isCorrect = arraysEqual(selectedAnswers, correctAnswers);
                updateStreak(isCorrect);

                if (!isCorrect && !isReviewMode) {
                    incorrectAnswerCount++;
                }
                currentPoints += isCorrect ? 10 : -5;
                showAnswerFeedback(selectedAnswers, correctAnswers, isCorrect);
                answered = true;
                saveAppState();
                return;
            }
            currentQuestionIndex++;
            if (currentQuestionIndex < questions.length) {
                showQuestion();
                answered = false;
            } else {
                if (incorrectQuestions.length > 0) {
                    currentQuestionIndex = 0;
                    questions = incorrectQuestions;
                    incorrectQuestions = [];
                    isReviewMode = true;
                    showQuestion();
                    answered = false;
                } else {
                    endTime = new Date();
                    const timeTaken = (endTime - startTime) / 1000;
                    lastTimeTaken = timeTaken;
                    lastIncorrectCount = incorrectAnswerCount;
                    testFinished = true;
                    saveTestResult(timeTaken, incorrectAnswerCount, currentPoints);
                    showResult(timeTaken, incorrectAnswerCount, currentPoints);
                }
            }
        });
        skipBtn.addEventListener('click', () => {
            endTime = new Date();
            const timeTaken = (endTime - startTime) / 1000;
            lastTimeTaken = timeTaken;
            lastIncorrectCount = incorrectAnswerCount;
            testFinished = true;
            saveTestResult(timeTaken, incorrectAnswerCount, currentPoints);
            showResult(timeTaken, incorrectAnswerCount, currentPoints);
        });
        function showAnswerFeedback(selectedAnswers, correctAnswers, isCorrect) {
            const choices = questionContainer.querySelectorAll('input[name="answer"]');
            choices.forEach(choice => {
                choice.parentElement.classList.remove('incorrect-answer', 'correct-answer', 'partially-correct-answer');
                const isSelected = selectedAnswers.includes(choice.value);
                const isAnswerCorrect = correctAnswers.includes(choice.value);
                if (isSelected && isAnswerCorrect) {
                    choice.parentElement.classList.add('correct-answer');
                } else if (isSelected && !isAnswerCorrect) {
                    choice.parentElement.classList.add('incorrect-answer');
                } else if (!isSelected && isAnswerCorrect) {
                    choice.parentElement.classList.add('partially-correct-answer');
                }
                choice.disabled = true;
            });
            if (!isCorrect) {
                incorrectQuestions.push(questions[currentQuestionIndex]);
            }
        }

        /********************** –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ç–µ—Å—Ç–∞ **********************/
        function saveAppState() {
            const state = {
                version: STATE_VERSION,
                timestamp: Date.now(),
                questions,
                originalQuestions,
                currentQuestionIndex,
                startTime: startTime ? startTime.toISOString() : null,
                answered,
                incorrectQuestions,
                incorrectAnswerCount,
                isReviewMode,
                totalQuestionsCount,
                testFinished,
                lastTimeTaken,
                lastIncorrectCount,
                currentPoints
            };
            localStorage.setItem('testAppState', JSON.stringify(state));
        }
        function loadAppState() {
            const saved = localStorage.getItem('testAppState');
            if (saved) {
                try {
                    const state = JSON.parse(saved);
                    if (state.version !== STATE_VERSION) {
                        console.warn('–°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–º–µ–µ—Ç –¥—Ä—É–≥—É—é –≤–µ—Ä—Å–∏—é. –ò–≥–Ω–æ—Ä–∏—Ä—É—é —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ.');
                        restartTest();
                        return;
                    }
                    if (Date.now() - state.timestamp > SAVE_EXPIRY) {
                        console.warn('–°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–ª–æ. –ò–≥–Ω–æ—Ä–∏—Ä—É—é —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ.');
                        restartTest();
                        return;
                    }
                    questions = state.questions;
                    originalQuestions = state.originalQuestions;
                    currentQuestionIndex = state.currentQuestionIndex;
                    startTime = state.startTime ? new Date(state.startTime) : null;
                    answered = state.answered;
                    incorrectQuestions = state.incorrectQuestions;
                    incorrectAnswerCount = state.incorrectAnswerCount;
                    isReviewMode = state.isReviewMode;
                    totalQuestionsCount = state.totalQuestionsCount;
                    testFinished = state.testFinished;
                    lastTimeTaken = state.lastTimeTaken;
                    lastIncorrectCount = state.lastIncorrectCount;
                    currentPoints = state.currentPoints;
                    if (testFinished) {
                        showResult(lastTimeTaken, lastIncorrectCount, currentPoints);
                    } else {
                        if (quickReviewModeBtn.classList.contains('active')) {
                            showQuickReviewMode();
                        } else {
                            showQuestion();
                        }
                    }
                } catch (err) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è', err);
                    restartTest();
                }
            } else {
                restartTest();
            }
        }
        let quickReviewOffset = 0;

        function showQuickReviewMode() {
            isReviewMode = true;

            const visibleQuestions = originalQuestions.slice(quickReviewOffset, quickReviewOffset + quickReviewChunkSize);

            visibleQuestions.forEach((q, index) => {
                let choicesHTML = '';
                q.choices.forEach(choice => {
                    const answerClass = q.correctAnswers.includes(choice) ? 'correct-answer' : '';
                    choicesHTML += `<br>--<label class="${answerClass}">${choice}</label><br>`;
                });

                const questionHTML = `
            <hr>
            <h5>–í–æ–ø—Ä–æ—Å ${quickReviewOffset + index + 1} / ${originalQuestions.length}</h5>
            <h4>${q.question}</h4>
            ${choicesHTML}
            ${q.image ? `<img src="${q.image}" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ" style="max-width: 100%; height: auto;">` : ''}
        `;

                questionContainer.innerHTML += questionHTML;
            });

            if (window.MathJax && MathJax.typesetPromise) {
                MathJax.typesetPromise();
            }

            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—É—é –∫–Ω–æ–ø–∫—É (–µ—Å–ª–∏ –µ—Å—Ç—å)
            const oldButton = document.getElementById('loadMoreBtn');
            if (oldButton) oldButton.remove();

            // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É, –µ—Å–ª–∏ –æ—Å—Ç–∞–ª–∏—Å—å –µ—â—ë –≤–æ–ø—Ä–æ—Å—ã
            if (quickReviewOffset + quickReviewChunkSize < originalQuestions.length) {
                const loadMoreBtn = document.createElement('button');
                loadMoreBtn.id = 'loadMoreBtn'; // –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è
                loadMoreBtn.textContent = '–ü–æ–∫–∞–∑–∞—Ç—å –µ—â—ë';
                loadMoreBtn.className = 'dropbtn';
                loadMoreBtn.style.marginTop = '20px';
                loadMoreBtn.style.display = 'block';
                loadMoreBtn.style.marginLeft = 'auto';
                loadMoreBtn.style.marginRight = 'auto';
                loadMoreBtn.onclick = () => {
                    quickReviewOffset += quickReviewChunkSize;
                    showQuickReviewMode();
                };
                questionContainer.appendChild(loadMoreBtn);
            }

        }




        /********************** –†–µ–∂–∏–º—ã –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è **********************/
        normalModeBtn.addEventListener('click', () => {
            normalModeBtn.classList.add('active');
            testModeBtn.classList.remove('active');
            quickReviewModeBtn.classList.remove('active');
            rangeModeBtn.classList.remove('active');
            rangeSelectionDiv.style.display = "none";
            searchInput.style.display = "none";
            searchInput.value = "";
            testFinished = false;
            restartTest();
            modeDropbtn.textContent = `–û–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º \u25BC`;
        });
        testModeBtn.addEventListener('click', () => {
            testModeBtn.classList.add('active');
            normalModeBtn.classList.remove('active');
            quickReviewModeBtn.classList.remove('active');
            rangeModeBtn.classList.remove('active');
            rangeSelectionDiv.style.display = "none";
            searchInput.style.display = "none";
            searchInput.value = "";
            testFinished = false;
            restartTest();
            modeDropbtn.textContent = `–¢–µ—Å—Ç-–∫–∞–±–∏–Ω–µ—Ç \u25BC`;
        });
        quickReviewModeBtn.addEventListener('click', () => {
            quickReviewModeBtn.classList.add('active');
            normalModeBtn.classList.remove('active');
            testModeBtn.classList.remove('active');
            rangeModeBtn.classList.remove('active');
            rangeSelectionDiv.style.display = "none";
            searchInput.style.display = "block";
            testFinished = false;
            restartTest();
            modeDropbtn.textContent = `–†–µ–∂–∏–º –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è \u25BC`;
        });
        rangeModeBtn.addEventListener('click', () => {
            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É —Ä–µ–∂–∏–º–∞
            setActiveMode(rangeModeBtn);

            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –Ω—É–∂–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
            rangeSelectionDiv.style.display = "block";
            searchInput.style.display = "none";
            randomizeRangeBtn.style.display = "none"; // —Å–∫—Ä—ã–≤–∞–µ–º –¥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –¥–∏–∞–ø–∞–∑–æ–Ω–∞
            nextBtn.style.display = "none";           // —Å–∫—Ä—ã–≤–∞–µ–º "–î–∞–ª–µ–µ", –ø–æ–∫–∞ –Ω–µ –ø—Ä–∏–º–µ–Ω–∏–ª–∏
            resultContainer.style.display = "none";   // —É–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ä—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

            // –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è
            questions = [];
            questionContainer.innerHTML = '<p style="text-align:center;">–í—ã–±–µ—Ä–∏—Ç–µ –¥–∏–∞–ø–∞–∑–æ–Ω –∏ –Ω–∞–∂–º–∏—Ç–µ "–ü—Ä–∏–º–µ–Ω–∏—Ç—å"</p>';
            currentQuestionIndex = 0;
            testFinished = false;

            modeDropbtn.textContent = `–†–µ–∂–∏–º –≤—ã–±–æ—Ä–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ ‚ñº`;
        });
        function setActiveMode(activeBtn) {
            [normalModeBtn, testModeBtn, quickReviewModeBtn, rangeModeBtn].forEach(btn => {
                btn.classList.remove('active');
            });
            activeBtn.classList.add('active');
        }


        applyRangeBtn.addEventListener('click', () => {
            const start = parseInt(rangeStartInput.value);
            const end = parseInt(rangeEndInput.value);

            if (isNaN(start) || isNaN(end) || start < 1 || end < start || end > originalQuestions.length) {
                alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω –æ—Ç 1 –¥–æ ' + originalQuestions.length);
                return;
            }

            questions = originalQuestions.slice(start - 1, end);
            totalQuestionsCount = questions.length;
            currentQuestionIndex = 0;
            incorrectQuestions = [];
            answered = false;
            startTime = new Date();
            isReviewMode = false;
            testFinished = false;


            randomizeRangeBtn.style.display = "inline-block";
            nextBtn.style.display = "block";
            rangePreviewDiv.innerHTML = '';


            showQuestion();
        });

        // –ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∫–Ω–æ–ø–∫—É —Ä–∞–Ω–¥–æ–º–∏–∑–∞—Ü–∏–∏ –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –≤–æ–ø—Ä–æ—Å—ã –∏ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –∏–Ω–¥–µ–∫—Å
        randomizeRangeBtn.addEventListener('click', () => {
            questions = questions.sort(() => Math.random() - 0.5);
            currentQuestionIndex = 0;
            showQuestion();
        });

        /********************** –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ **********************/
        function saveTestResult(timeTaken, incorrectCount, points) {
            const now = new Date();
            const result = {
                date: now.toISOString(),
                timeTaken,
                incorrectCount,
                points,
                totalQuestions: totalQuestionsCount,
                percentCorrect: (((totalQuestionsCount - incorrectCount) / totalQuestionsCount) * 100).toFixed(2)
            };
            let results = JSON.parse(localStorage.getItem(RESULTS_STORAGE_KEY)) || [];
            results = results.filter(r => {
                const rDate = new Date(r.date);
                return rDate.getFullYear() === now.getFullYear() && rDate.getMonth() === now.getMonth();
            });
            results.push(result);
            localStorage.setItem(RESULTS_STORAGE_KEY, JSON.stringify(results));
        }
        function showResult(timeTaken, incorrectCount, points) {
            questionContainer.style.display = 'none';
            nextBtn.style.display = 'none';
            resultContainer.style.display = 'block';
            let resultHTML = `<h2>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ—Å—Ç–∞</h2>
                <p>–í—Ä–µ–º—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è: ${timeTaken} —Å–µ–∫—É–Ω–¥</p>
                <p>–û—à–∏–±–æ–∫: ${incorrectCount}</p>
                <p>–í—Å–µ–≥–æ –≤–æ–ø—Ä–æ—Å–æ–≤: ${totalQuestionsCount}</p>
                <p>–ü—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤: ${(((totalQuestionsCount - incorrectCount) / totalQuestionsCount) * 100).toFixed(2)}%</p>`;

            const results = JSON.parse(localStorage.getItem(RESULTS_STORAGE_KEY)) || [];
            resultContainer.innerHTML = resultHTML;
        }

        let currentBranch = localStorage.getItem('selectedBranch') || 'main';

        function switchBranch(branchName) {
            currentBranch = branchName;
            localStorage.setItem('selectedBranch', branchName);
            document.getElementById('branchDropbtn').textContent = `–ì—Ä—É–ø–ø–∞: ${branchName} ‚ñº`;
            loadFilesFromGitHub(); // –∑–∞–≥—Ä—É–∑–∫–∞ —Ç–µ—Å—Ç–æ–≤ –∏–∑ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –≤–µ—Ç–∫–∏
        }

        async function loadBranchesFromGitHub() {
            const repoOwner = 'FORBIX7';
            const repoName = 'lab02-';
            const apiUrl = `https://api.github.com/repos/${repoOwner}/${repoName}/branches`;

            try {
                const response = await fetch(apiUrl);
                if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–ø–∏—Å–∫–∞ –≤–µ—Ç–æ–∫');

                const branches = await response.json();
                const dropdown = document.getElementById('branchDropdownContent');
                dropdown.innerHTML = ''; // –æ—á–∏—â–∞–µ–º

                // –î–æ–±–∞–≤–ª—è–µ–º –≤–µ—Ç–∫–∏ –∫—Ä–æ–º–µ main
                branches
                    .filter(branch => branch.name !== 'main')
                    .forEach(branch => {
                        const a = document.createElement('a');
                        a.href = '#';
                        a.textContent = branch.name;
                        a.onclick = (e) => {
                            e.preventDefault();
                            switchBranch(branch.name);
                        };
                        dropdown.appendChild(a);
                    });

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—É—â—É—é –≤–µ—Ç–∫—É
                document.getElementById('branchDropbtn').textContent = `–ì—Ä—É–ø–ø–∞: ${currentBranch} ‚ñº`;

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–µ—Ç–æ–∫:', error);
                document.getElementById('branchDropbtn').textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥—Ä—É–ø–ø ‚ñº';
            }
        }


        /********************** –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è **********************/
        document.addEventListener('DOMContentLoaded', () => {
            loadTheme();
            loadBranchesFromGitHub(); // —Å–Ω–∞—á–∞–ª–∞ –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ –≤–µ—Ç–æ–∫
            loadFilesFromGitHub();     // –ø–æ—Ç–æ–º –∑–∞–≥—Ä—É–∂–∞–µ–º —Ñ–∞–π–ª—ã –∏–∑ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –≤–µ—Ç–∫–∏
            loadAppState();
        });
        window.addEventListener('beforeunload', saveAppState);
    </script>

</body>

</html>
